<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calcul Vent IFR</title>
<link rel="manifest" href="manifest.webmanifest">
<style>
body {
    font-family: Arial, sans-serif;
    background:#111;
    color:#eee;
    text-align:center;
}
button, input {
    font-size:1.2em;
    padding:6px;
    margin:5px;
}
.box { margin:15px; font-size:1.4em; }
</style>
</head>
<body>

<h1>Calcul Vent – IFR</h1>

<select id="mode">
    <option value="train">Entraînement</option>
    <option value="exam">Examen IFR</option>
</select>
<br><br>
<button onclick="start()">Démarrer</button>

<div class="box" id="question"></div>

<div id="inputs" style="display:none;">
    HW <input type="number" id="hw"> kt
    XW <input type="number" id="xw"> kt<br>
    <button onclick="validate()">Valider</button>
</div>

<div class="box" id="result"></div>

<script>
const sinTable = {0:0,10:0.2,20:0.3,30:0.5,40:0.6,50:0.7,60:0.8,70:0.9,80:1,90:1};
const cosTable = {0:1,10:1,20:0.9,30:0.8,40:0.7,50:0.6,60:0.5,70:0.3,80:0.2,90:0};

let count, score, startTime, solution, tolerance, exam;

function start() {
    count = 0;
    score = 0;
    solution = {};
    exam = document.getElementById("mode").value === "exam";
    tolerance = exam ? 0 : 1;

    startTime = Date.now();
    document.getElementById("result").innerHTML = "";
    document.getElementById("inputs").style.display = "block";
    next();
}

function next() {
    if (count === 10) {
        finish();
        return;
    }

    count++;

    const qfu = Math.floor(Math.random()*36)+1;
    const runway = qfu * 10;
    const windDir = Math.floor(Math.random()*360)+1;
    const windSpeed = Math.floor(Math.random()*33)+3;

    const rounded = Math.round(windDir/10)*10;

    let alpha = Math.abs(rounded - runway);
    if (alpha > 180) alpha = 360 - alpha;
    if (alpha > 90) alpha = 180 - alpha;
    alpha = Math.round(alpha / 10) * 10;

    solution.hw = Math.round(cosTable[alpha] * windSpeed);
    solution.xw = Math.round(sinTable[alpha] * windSpeed);

    document.getElementById("question").innerHTML = `
        <b>${exam ? "Examen IFR" : "Entraînement"} – Question ${count}/10</b><br>
        QFU ${String(qfu).padStart(2,"0")}<br>
        Vent ${String(windDir).padStart(3,"0")}@${windSpeed}kt
    `;

    document.getElementById("hw").value = "";
    document.getElementById("xw").value = "";
}

function validate() {
    const hw = Number(document.getElementById("hw").value);
    const xw = Number(document.getElementById("xw").value);

    if (Math.abs(hw - solution.hw) <= tolerance &&
        Math.abs(xw - solution.xw) <= tolerance) {
        score++;
    }
    next();
}

function finish() {
    const time = ((Date.now() - startTime) / 1000).toFixed(1);
    document.getElementById("inputs").style.display = "none";
    document.getElementById("question").innerHTML = "";

    document.getElementById("result").innerHTML = `
        <b>Résultat ${exam ? "EXAMEN IFR" : ""}</b><br>
        Score : ${score}/10<br>
        Temps : ${time} s
    `;
}
</script>

</body>
</html>
